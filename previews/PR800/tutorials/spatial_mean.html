<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Computing spatial means | Rasters.jl</title>
    <meta name="description" content="Manipulating rasterized spatial data">
    <meta name="generator" content="VitePress v1.4.1">
    <link rel="preload stylesheet" href="/Rasters.jl/previews/PR800/assets/style.DSDrXxgN.css" as="style">
    
    <script type="module" src="/Rasters.jl/previews/PR800/assets/app.C1ATy_hq.js"></script>
    <link rel="preload" href="/Rasters.jl/previews/PR800/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/Rasters.jl/previews/PR800/assets/chunks/theme.BrNjhaGR.js">
    <link rel="modulepreload" href="/Rasters.jl/previews/PR800/assets/chunks/framework.Gz-llJN4.js">
    <link rel="modulepreload" href="/Rasters.jl/previews/PR800/assets/tutorials_spatial_mean.md.DBbIpaS6.lean.js">
    <link rel="icon" href="/public/favicon.ico">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-a9a9e638><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c3508ec8></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c3508ec8> Skip to content </a><!--]--><!----><header class="VPNav" data-v-a9a9e638 data-v-f1e365da><div class="VPNavBar" data-v-f1e365da data-v-822684d1><div class="wrapper" data-v-822684d1><div class="container" data-v-822684d1><div class="title" data-v-822684d1><div class="VPNavBarTitle has-sidebar" data-v-822684d1 data-v-28a961f9><a class="title" href="/Rasters.jl/previews/PR800/" data-v-28a961f9><!--[--><!--]--><!--[--><img class="VPImage logo" src="/Rasters.jl/previews/PR800/logo.png" alt data-v-35a7d0b8><!--]--><span data-v-28a961f9>Rasters.jl</span><!--[--><!--]--></a></div></div><div class="content" data-v-822684d1><div class="content-body" data-v-822684d1><!--[--><!--]--><div class="VPNavBarSearch search" data-v-822684d1><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-822684d1 data-v-e6d46098><span id="main-nav-aria-label" class="visually-hidden" data-v-e6d46098> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Rasters.jl/previews/PR800/" tabindex="0" data-v-e6d46098 data-v-956ec74c><!--[--><span data-v-956ec74c>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Rasters.jl/previews/PR800/get_started" tabindex="0" data-v-e6d46098 data-v-956ec74c><!--[--><span data-v-956ec74c>Get Started</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e6d46098 data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><!----><span data-v-04f5c5e9>Methods</span><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/Rasters.jl/previews/PR800/methods" data-v-acbfed09><!--[--><span data-v-acbfed09>Overview</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/Rasters.jl/previews/PR800/array_operations" data-v-acbfed09><!--[--><span data-v-acbfed09>Array Operations</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-e6d46098 data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><!----><span data-v-04f5c5e9>Tutorials</span><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link active" href="/Rasters.jl/previews/PR800/tutorials/spatial_mean" data-v-acbfed09><!--[--><span data-v-acbfed09>Computing spatial means</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e6d46098 data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><!----><span data-v-04f5c5e9>Data Sources</span><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/Rasters.jl/previews/PR800/data_sources" data-v-acbfed09><!--[--><span data-v-acbfed09>Overview</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/Rasters.jl/previews/PR800/gbif_wflow" data-v-acbfed09><!--[--><span data-v-acbfed09>GBIF</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e6d46098 data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><!----><span data-v-04f5c5e9>Plots</span><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/Rasters.jl/previews/PR800/plotting" data-v-acbfed09><!--[--><span data-v-acbfed09>Plots.jl</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/Rasters.jl/previews/PR800/plot_makie" data-v-acbfed09><!--[--><span data-v-acbfed09>Makie.jl</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e6d46098 data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><!----><span data-v-04f5c5e9>Ecosystem</span><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link vp-external-link-icon" href="https://rafaqz.github.io/DimensionalData.jl/dev/" target="_blank" rel="noreferrer" data-v-acbfed09><!--[--><span data-v-acbfed09>DimensionalData.jl</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link vp-external-link-icon" href="https://alexander-barth.github.io/NCDatasets.jl/stable/" target="_blank" rel="noreferrer" data-v-acbfed09><!--[--><span data-v-acbfed09>NCDatasets.jl</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link vp-external-link-icon" href="https://yeesian.com/ArchGDAL.jl/stable/" target="_blank" rel="noreferrer" data-v-acbfed09><!--[--><span data-v-acbfed09>ArchGDAL.jl</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link vp-external-link-icon" href="https://juliaio.github.io/HDF5.jl/stable/" target="_blank" rel="noreferrer" data-v-acbfed09><!--[--><span data-v-acbfed09>HDF5.jl</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Rasters.jl/previews/PR800/api" tabindex="0" data-v-e6d46098 data-v-956ec74c><!--[--><span data-v-956ec74c>API</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-822684d1 data-v-af096f4a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-af096f4a data-v-e40a8bb6 data-v-4a1c76db><span class="check" data-v-4a1c76db><span class="icon" data-v-4a1c76db><!--[--><span class="vpi-sun sun" data-v-e40a8bb6></span><span class="vpi-moon moon" data-v-e40a8bb6></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-822684d1 data-v-164c457f data-v-ee7a9424><!--[--><a class="VPSocialLink no-icon" href="https://github.com/rafaqz/Rasters.jl" aria-label="github" target="_blank" rel="noopener" data-v-ee7a9424 data-v-717b8b75><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-822684d1 data-v-925effce data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-04f5c5e9><span class="vpi-more-horizontal icon" data-v-04f5c5e9></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><!----><!--[--><!--[--><!----><div class="group" data-v-925effce><div class="item appearance" data-v-925effce><p class="label" data-v-925effce>Appearance</p><div class="appearance-action" data-v-925effce><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-925effce data-v-e40a8bb6 data-v-4a1c76db><span class="check" data-v-4a1c76db><span class="icon" data-v-4a1c76db><!--[--><span class="vpi-sun sun" data-v-e40a8bb6></span><span class="vpi-moon moon" data-v-e40a8bb6></span><!--]--></span></span></button></div></div></div><div class="group" data-v-925effce><div class="item social-links" data-v-925effce><div class="VPSocialLinks social-links-list" data-v-925effce data-v-ee7a9424><!--[--><a class="VPSocialLink no-icon" href="https://github.com/rafaqz/Rasters.jl" aria-label="github" target="_blank" rel="noopener" data-v-ee7a9424 data-v-717b8b75><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-822684d1 data-v-5dea55bf><span class="container" data-v-5dea55bf><span class="top" data-v-5dea55bf></span><span class="middle" data-v-5dea55bf></span><span class="bottom" data-v-5dea55bf></span></span></button></div></div></div></div><div class="divider" data-v-822684d1><div class="divider-line" data-v-822684d1></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-a9a9e638 data-v-070ab83d><div class="container" data-v-070ab83d><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-070ab83d><span class="vpi-align-left menu-icon" data-v-070ab83d></span><span class="menu-text" data-v-070ab83d>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-070ab83d data-v-bc9dc845><button data-v-bc9dc845>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-a9a9e638 data-v-18756405><div class="curtain" data-v-18756405></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-18756405><span class="visually-hidden" id="sidebar-aria-label" data-v-18756405> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-196b2e5f><!----><div class="items" data-v-196b2e5f><!--[--><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Rasters.jl/previews/PR800/get_started" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Get Started</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-196b2e5f><div class="item" role="button" tabindex="0" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><h2 class="text" data-v-196b2e5f>Methods</h2><!----></div><div class="items" data-v-196b2e5f><!--[--><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Rasters.jl/previews/PR800/methods" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Overview</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Rasters.jl/previews/PR800/array_operations" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Array Operations</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-196b2e5f><div class="item" role="button" tabindex="0" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><h2 class="text" data-v-196b2e5f>Data Sources</h2><!----></div><div class="items" data-v-196b2e5f><!--[--><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Rasters.jl/previews/PR800/data_sources" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Overview</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Rasters.jl/previews/PR800/gbif_wflow" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>GBIF</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-196b2e5f><div class="item" role="button" tabindex="0" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><h2 class="text" data-v-196b2e5f>Plots</h2><!----></div><div class="items" data-v-196b2e5f><!--[--><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Rasters.jl/previews/PR800/plotting" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Plots.jl</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Rasters.jl/previews/PR800/plot_makie" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Makie.jl</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-196b2e5f><!----><div class="items" data-v-196b2e5f><!--[--><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Rasters.jl/previews/PR800/api" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>API</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-a9a9e638 data-v-91765379><div class="VPDoc has-sidebar has-aside" data-v-91765379 data-v-83890dd9><!--[--><!--]--><div class="container" data-v-83890dd9><div class="aside" data-v-83890dd9><div class="aside-curtain" data-v-83890dd9></div><div class="aside-container" data-v-83890dd9><div class="aside-content" data-v-83890dd9><div class="VPDocAside" data-v-83890dd9 data-v-6d7b3c46><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-6d7b3c46 data-v-b38bf2ff><div class="content" data-v-b38bf2ff><div class="outline-marker" data-v-b38bf2ff></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-b38bf2ff>On this page</div><ul class="VPDocOutlineItem root" data-v-b38bf2ff data-v-3f927ebe><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-6d7b3c46></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-83890dd9><div class="content-container" data-v-83890dd9><!--[--><!--]--><main class="main" data-v-83890dd9><div style="position:relative;" class="vp-doc _Rasters_jl_previews_PR800_tutorials_spatial_mean" data-v-83890dd9><div><h1 id="Computing-spatial-means" tabindex="-1">Computing spatial means <a class="header-anchor" href="#Computing-spatial-means" aria-label="Permalink to &quot;Computing spatial means {#Computing-spatial-means}&quot;">​</a></h1><p>It&#39;s very common to want to compute the mean of some value over some area of a raster. The initial approach is to simply average the values, but this will give you the arithmetic mean, not the spatial mean.</p><p>The reason for this is that raster cells do not always have the same area, especially over a large region of the Earth where its curvature comes into play.</p><p>To compute the spatial mean, you need to weight the values by the area of each cell. You can do this by multiplying the values by the cell area, then summing the values, and dividing that number by the total area. That was the motivation for this example.</p><p>Let&#39;s get the rainfall over Chile, and compute the average rainfall across the country for the month of June.</p><h2 id="Acquiring-the-data" tabindex="-1">Acquiring the data <a class="header-anchor" href="#Acquiring-the-data" aria-label="Permalink to &quot;Acquiring the data {#Acquiring-the-data}&quot;">​</a></h2><p>We&#39;ll get the precipitation data across the globe from <a href="https://www.worldclim.org/data/index.html" target="_blank" rel="noreferrer">WorldClim</a>, via <a href="https://github.com/EcoJulia/RasterDataSources.jl" target="_blank" rel="noreferrer">RasterDataSources.jl</a>, and use the <code>month</code> keyword argument to get the June data.</p><p>Then, we can get the geometry of Chile from <a href="https://github.com/JuliaGeo/NaturalEarth.jl" target="_blank" rel="noreferrer">NaturalEarth.jl</a>, and use <code>Rasters.mask</code> to get the data just for Chile.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Rasters</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Proj </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># to activate the spherical `cellarea` method</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ArchGDAL, RasterDataSources, NaturalEarth </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># purely for data loading</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CairoMakie </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># for plotting</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">precip </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Raster</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(WorldClim{Climate}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:prec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; month </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>╭────────────────────────────────╮</span></span>
<span class="line"><span>│ 2160×1080 Raster{Int16,2} prec │</span></span>
<span class="line"><span>├────────────────────────────────┴─────────────────────────────────────── dims ┐</span></span>
<span class="line"><span>  ↓ X Projected{Float64} LinRange{Float64}(-180.0, 179.83333333333331, 2160) ForwardOrdered Regular Intervals{Start},</span></span>
<span class="line"><span>  → Y Projected{Float64} LinRange{Float64}(89.83333333333333, -90.0, 1080) ReverseOrdered Regular Intervals{Start}</span></span>
<span class="line"><span>├──────────────────────────────────────────────────────────────────── metadata ┤</span></span>
<span class="line"><span>  Metadata{Rasters.GDALsource} of Dict{String, Any} with 4 entries:</span></span>
<span class="line"><span>  &quot;units&quot;    =&gt; &quot;&quot;</span></span>
<span class="line"><span>  &quot;offset&quot;   =&gt; 0.0</span></span>
<span class="line"><span>  &quot;filepath&quot; =&gt; &quot;./WorldClim/Climate/prec/wc2.1_10m_prec_06.tif&quot;</span></span>
<span class="line"><span>  &quot;scale&quot;    =&gt; 1.0</span></span>
<span class="line"><span>├────────────────────────────────────────────────────────────────────── raster ┤</span></span>
<span class="line"><span>  extent: Extent(X = (-180.0, 179.99999999999997), Y = (-90.0, 90.0))</span></span>
<span class="line"><span>  missingval: -32768</span></span>
<span class="line"><span>  crs: GEOGCS[&quot;WGS 84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0,AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],UNIT[&quot;degree&quot;,0.0174532925199433,AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],AXIS[&quot;Latitude&quot;,NORTH],AXIS[&quot;Longitude&quot;,EAST],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]</span></span>
<span class="line"><span>└──────────────────────────────────────────────────────────────────────────────┘</span></span>
<span class="line"><span>    ↓ →        89.8333      89.6667  …  -89.5  -89.6667  -89.8333  -90.0</span></span>
<span class="line"><span> -180.0    -32768       -32768            0      0         0         0</span></span>
<span class="line"><span>    ⋮                                ⋱                               ⋮</span></span>
<span class="line"><span>  179.833  -32768       -32768       …    0      0         0         0</span></span></code></pre></div><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">all_countries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> naturalearth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;admin_0_countries&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chile </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all_countries</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">geometry[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">findfirst</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Chile&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), all_countries</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAME)]</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>2D MultiPolygonwith 163 sub-geometries</span></span></code></pre></div><p>Let&#39;s plot the precipitation on the world map, and highlight Chile:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">f, a, p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> heatmap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(precip; colorrange </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Makie</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">zscale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">replace_missing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(precip, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NaN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)), axis </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; aspect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> DataAspect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">p2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> poly!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a, chile; color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:red</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), strokecolor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :red</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, strokewidth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">f</span></span></code></pre></div><p><img src="/Rasters.jl/previews/PR800/assets/lkchufx.7f-p2R5g.png" alt=""></p><p>You can see Chile highlighted in red, in the bottom left quadrant.</p><h2 id="Processing-the-data" tabindex="-1">Processing the data <a class="header-anchor" href="#Processing-the-data" aria-label="Permalink to &quot;Processing the data {#Processing-the-data}&quot;">​</a></h2><p>First, let&#39;s make sure that we only have the data that we care about, and crop and mask the raster so it only has values in Chile. We can crop by the geometry, which really just generates a view into the raster that is bounded by the geometry&#39;s bounding box.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cropped_precip </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> crop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(precip; to </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chile)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>╭──────────────────────────────╮</span></span>
<span class="line"><span>│ 257×229 Raster{Int16,2} prec │</span></span>
<span class="line"><span>├──────────────────────────────┴───────────────────────────────────────── dims ┐</span></span>
<span class="line"><span>  ↓ X Projected{Float64} LinRange{Float64}(-109.33333333333334, -66.66666666666667, 257) ForwardOrdered Regular Intervals{Start},</span></span>
<span class="line"><span>  → Y Projected{Float64} LinRange{Float64}(-17.83333333333333, -55.83333333333334, 229) ReverseOrdered Regular Intervals{Start}</span></span>
<span class="line"><span>├──────────────────────────────────────────────────────────────────── metadata ┤</span></span>
<span class="line"><span>  Metadata{Rasters.GDALsource} of Dict{String, Any} with 4 entries:</span></span>
<span class="line"><span>  &quot;units&quot;    =&gt; &quot;&quot;</span></span>
<span class="line"><span>  &quot;offset&quot;   =&gt; 0.0</span></span>
<span class="line"><span>  &quot;filepath&quot; =&gt; &quot;./WorldClim/Climate/prec/wc2.1_10m_prec_06.tif&quot;</span></span>
<span class="line"><span>  &quot;scale&quot;    =&gt; 1.0</span></span>
<span class="line"><span>├────────────────────────────────────────────────────────────────────── raster ┤</span></span>
<span class="line"><span>  extent: Extent(X = (-109.33333333333334, -66.5), Y = (-55.83333333333334, -17.66666666666666))</span></span>
<span class="line"><span>  missingval: -32768</span></span>
<span class="line"><span>  crs: GEOGCS[&quot;WGS 84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0,AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],UNIT[&quot;degree&quot;,0.0174532925199433,AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],AXIS[&quot;Latitude&quot;,NORTH],AXIS[&quot;Longitude&quot;,EAST],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]</span></span>
<span class="line"><span>└──────────────────────────────────────────────────────────────────────────────┘</span></span>
<span class="line"><span>    ↓ →        -17.8333     -18.0  …     -55.5     -55.6667     -55.8333</span></span>
<span class="line"><span> -109.333   -32768       -32768       -32768    -32768       -32768</span></span>
<span class="line"><span>    ⋮                              ⋱                         </span></span>
<span class="line"><span>  -66.6667       6            5       -32768    -32768       -32768</span></span></code></pre></div><p>Now, we mask the data such that any data outside the geometry is set to <code>missing</code>.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">masked_precip </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> mask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cropped_precip; with </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chile)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">heatmap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(masked_precip)</span></span></code></pre></div><p><img src="/Rasters.jl/previews/PR800/assets/gvrnsiv.D-TYhoHQ.png" alt=""></p><p>This is a lot of missing data, but that&#39;s mainly because the Chile geometry we have encompasses the Easter Islands as well, in the middle of the Pacific.</p><details class="jldocstring custom-block"><summary><a id="Rasters.cellarea-tutorials-spatial_mean" href="#Rasters.cellarea-tutorials-spatial_mean"><span class="jlbinding">Rasters.cellarea</span></a> <span class="VPBadge info jlObjectType jlFunction"><!--[-->Function<!--]--></span></summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cellarea</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([method], x)</span></span></code></pre></div><p>Gives the approximate area of each gridcell of <code>x</code>. By assuming the earth is a sphere, it approximates the true size to about 0.1%, depending on latitude.</p><p>Run <code>using Proj</code> to make this method fully available.</p><p><code>method</code> can be <code>Spherical(; radius)</code> (the default) or <code>Planar()</code>.</p><ul><li><p><code>Spherical</code> will compute cell area on the sphere, by transforming all points back to long-lat. You can specify the radius by the <code>radius</code> keyword argument here. By default, this is <code>6371008.8</code>, the mean radius of the Earth.</p></li><li><p><code>Planar</code> will compute cell area in the plane of the CRS you have chosen. Be warned that this will likely be incorrect for non-equal-area projections.</p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Rasters, Proj, Rasters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Lookups</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># First, we construct a raster with cell-based sampling (`Intervals`),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># where the value represents the start of the cell in each dimension (`Start`).</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">xdim </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> X</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Projected</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">90.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">120</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; sampling</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Intervals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()), crs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">EPSG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4326</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># construct cell-based sampling, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ydim </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Y</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Projected</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; sampling</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Intervals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()), crs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">EPSG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4326</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Now, we construct a raster from these dimensions, and compute the cell area.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">myraster </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(xdim, ydim)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cellarea</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myraster)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># output</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">╭───────────────────────╮</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">│ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">×</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Raster{Float64,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} │</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">├───────────────────────┴─────────────────────────────────────────────────── dims ┐</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ↓</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> X Projected{Float64} </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">90.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">120.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ForwardOrdered Regular Intervals{Start},</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  →</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Y Projected{Float64} </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ForwardOrdered Regular Intervals{Start}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">├───────────────────────────────────────────────────────────────────────── raster ┤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  extent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Extent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(X </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">90.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">130.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), Y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  crs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EPSG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4326</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">└─────────────────────────────────────────────────────────────────────────────────┘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   ↓</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> →</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        10.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        20.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        30.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            40.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      50.0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  90.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.23017e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1.19279e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1.11917e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1.01154e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  873182.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  708290.0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.23017e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1.19279e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1.11917e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1.01154e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  873182.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  708290.0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 110.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.23017e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1.19279e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1.11917e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1.01154e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  873182.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  708290.0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 120.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.23017e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1.19279e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1.11917e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   1.01154e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  873182.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  708290.0</span></span></code></pre></div><p>Note how the cell area decreases with increasing latitude, i.e., as we move away from the equator.</p><p>Compare this to the output from <code>cellarea(Planar(), ...)</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cellarea</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Planar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), myraster)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># output</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">╭───────────────────────╮</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">│ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">×</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Raster{Float64,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} │</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">├───────────────────────┴────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── dims ┐</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ↓</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> X Projected{Float64} </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">90.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">120.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ForwardOrdered Regular Intervals{Start},</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  →</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Y Projected{Float64} </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ForwardOrdered Regular Intervals{Start}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">├──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── raster ┤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  extent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Extent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(X </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">90.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">130.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), Y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  crs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EPSG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4326</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   ↓</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> →</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   10.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   20.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   30.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   40.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   50.0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  90.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 110.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 120.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  100.0</span></span></code></pre></div><p>The output here is clearly incorrect - but you can see how it&#39;s calculated, and that in an equal-area projection, it could be useful.</p><p>Let&#39;s look at <code>cellarea</code> in the Web Mercator projection:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mywebmerc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> reproject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myraster; crs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> EPSG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3857</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># this is the EPSG code for Web Mercator</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cellarea</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mywebmerc)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># output</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">╭───────────────────────╮</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">│ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">×</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Raster{Float64,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} │</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">├───────────────────────┴────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── dims ┐</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ↓</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> X Projected{Float64} [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0018754171394622e7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.1131949079327356e7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.2245143987260092e7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.3358338895192828e7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] ForwardOrdered Regular Intervals{Start},</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  →</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Y Projected{Float64} [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.1188899748579594e6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">…</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4.865942279503176e6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6.446275841017159e6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] ForwardOrdered Irregular Intervals{Start}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">├──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── raster ┤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  extent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Extent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(X </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0018754171394622e7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.4471533803125564e7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), Y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8.399737889818357e6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  crs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EPSG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3857</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ↓</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> →</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        1.11889e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  2.27303e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   3.50355e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   4.86594e6</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   6.44628e6</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.00188e7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.2332e12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.1952e12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.12048e12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.01158e12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  8.72085e11</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  7.06488e11</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.11319e7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.2332e12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.1952e12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.12048e12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.01158e12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  8.72085e11</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  7.06488e11</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.22451e7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.2332e12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.1952e12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.12048e12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.01158e12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  8.72085e11</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  7.06488e11</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.33583e7</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.2332e12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.1952e12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.12048e12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1.01158e12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  8.72085e11</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  7.06488e11</span></span></code></pre></div><p>WARNING: This feature is experimental. It may change in future versions, and may not be 100% reliable in all cases. Please file github issues if problems occur.</p><p><a href="https://github.com/rafaqz/Rasters.jl/blob/00f42123900bc375ea2f7d126d4b68b8b7039ec3/src/extensions.jl#L161-L254" target="_blank" rel="noreferrer">source</a></p></details><p><code>cellarea</code> computes the area of each cell in a raster. This is useful for a number of reasons - if you have a variable like population per cell, or elevation (<a href="https://r-spatial.org/book/05-Attributes.html#sec-extensiveintensive" target="_blank" rel="noreferrer">spatially extensive variables</a>), you&#39;ll want to account for the fact that different cells have different areas.</p><p>You can specify whether you want to compute the area in the plane of your projection (<code>Planar()</code>), or on a sphere of some radius (<code>Spherical(; radius=...)</code>).</p><p>Now, let&#39;s compute the average precipitation per square meter across Chile. First, we need to get the area of each cell in square meters. We&#39;ll use the spherical method, since we&#39;re working with a geographic coordinate system. This is the default.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">areas </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cellarea</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(masked_precip)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">masked_areas </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> mask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(areas; with </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chile)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">heatmap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(masked_areas; axis </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; title </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Cell area in square meters&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><p><img src="/Rasters.jl/previews/PR800/assets/fomptfw.CPrVXbo5.png" alt=""></p><p>You can see here that cells are largest towards the equator, and smallest away from it. This means that cells away from the equator should have a smaller contribution to the average than cells nearer the equator.</p><h2 id="Computing-the-spatial-mean" tabindex="-1">Computing the spatial mean <a class="header-anchor" href="#Computing-the-spatial-mean" aria-label="Permalink to &quot;Computing the spatial mean {#Computing-the-spatial-mean}&quot;">​</a></h2><p>Now we can compute the average precipitation per square meter. First, we compute total precipitation per grid cell:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">precip_per_area </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> masked_precip </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> masked_areas</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>╭───────────────────────────────────────────╮</span></span>
<span class="line"><span>│ 257×229 Raster{Union{Missing, Float64},2} │</span></span>
<span class="line"><span>├───────────────────────────────────────────┴──────────────────────────── dims ┐</span></span>
<span class="line"><span>  ↓ X Projected{Float64} LinRange{Float64}(-109.33333333333334, -66.66666666666667, 257) ForwardOrdered Regular Intervals{Start},</span></span>
<span class="line"><span>  → Y Projected{Float64} LinRange{Float64}(-17.83333333333333, -55.83333333333334, 229) ReverseOrdered Regular Intervals{Start}</span></span>
<span class="line"><span>├──────────────────────────────────────────────────────────────────── metadata ┤</span></span>
<span class="line"><span>  Metadata{Rasters.GDALsource} of Dict{String, Any} with 4 entries:</span></span>
<span class="line"><span>  &quot;units&quot;    =&gt; &quot;&quot;</span></span>
<span class="line"><span>  &quot;offset&quot;   =&gt; 0.0</span></span>
<span class="line"><span>  &quot;filepath&quot; =&gt; &quot;./WorldClim/Climate/prec/wc2.1_10m_prec_06.tif&quot;</span></span>
<span class="line"><span>  &quot;scale&quot;    =&gt; 1.0</span></span>
<span class="line"><span>├────────────────────────────────────────────────────────────────────── raster ┤</span></span>
<span class="line"><span>  extent: Extent(X = (-109.33333333333334, -66.5), Y = (-55.83333333333334, -17.66666666666666))</span></span>
<span class="line"><span>  missingval: -32768.0</span></span>
<span class="line"><span>  crs: GEOGCS[&quot;WGS 84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0,AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],UNIT[&quot;degree&quot;,0.0174532925199433,AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],AXIS[&quot;Latitude&quot;,NORTH],AXIS[&quot;Longitude&quot;,EAST],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]</span></span>
<span class="line"><span>└──────────────────────────────────────────────────────────────────────────────┘</span></span>
<span class="line"><span>    ↓ →     -17.8333    -18.0       …  -55.5       -55.6667    -55.8333</span></span>
<span class="line"><span> -109.333      missing     missing        missing     missing     missing</span></span>
<span class="line"><span>    ⋮                               ⋱                          </span></span>
<span class="line"><span>  -66.6667     missing     missing        missing     missing     missing</span></span></code></pre></div><p>We can sum this to get the total precipitation per square meter across Chile:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">total_precip </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">skipmissing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(precip_per_area))</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>8.143158931480217e13</span></span></code></pre></div><p>We can also sum the areas to get the total area of Chile (in this raster, at least).</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">total_area </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">skipmissing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(masked_areas))</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>7.34410965525973e11</span></span></code></pre></div><p>And we can convert that to an average by dividing by the total area:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">avg_precip </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> total_precip </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> total_area</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>110.88013814783146</span></span></code></pre></div><p>According to the internet, Chile gets about 100mm of rain per square meter in June, so our statistic seems pretty close.</p><p>Let&#39;s see what happens if we don&#39;t account for cell areas. An equivalent assumption would be that all cells have the same area.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bad_total_precip </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">skipmissing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(masked_precip))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bad_avg_precip </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bad_total_precip </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">collect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">skipmissing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(masked_precip)))</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>118.05119825708061</span></span></code></pre></div><p>This is misestimated! This is why it&#39;s important to account for cell areas when computing averages.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>If you made it this far, congratulations!</p><p>It&#39;s interesting to note that we&#39;ve replicated the workflow of <code>zonal</code> here. <code>zonal</code> is a more general function that can be used to compute any function over geometries, and it has multithreading built in.</p><p>But fundamentally, this is all that <code>zonal</code> is doing under the hood - masking and cropping the raster to the geometry, and then computing the statistic.</p></div><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to &quot;Summary&quot;">​</a></h2><p>In this tutorial, we&#39;ve seen how to compute the spatial mean of a raster, and how to account for the fact that raster cells do not always have the same area.</p><p>We&#39;ve also seen how to use the <code>cellarea</code> function to compute the area of each cell in a raster, and how to use the <code>mask</code> function to get the data within a geometry.</p><p>We&#39;ve seen that the spatial mean is not the same as the arithmetic mean, and that we need to account for the area of each cell when computing the average.</p></div></div></main><footer class="VPDocFooter" data-v-83890dd9 data-v-4f9813fa><!--[--><!--]--><div class="edit-info" data-v-4f9813fa><div class="edit-link" data-v-4f9813fa><a class="VPLink link no-icon edit-link-button" href="/Rasters.jl/previews/PR800/REPLACE_ME_DOCUMENTER_VITEPRESS" data-v-4f9813fa><!--[--><span class="vpi-square-pen edit-link-icon" data-v-4f9813fa></span> Edit this page<!--]--></a></div><!----></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-4f9813fa><span class="visually-hidden" id="doc-footer-aria-label" data-v-4f9813fa>Pager</span><div class="pager" data-v-4f9813fa><!----></div><div class="pager" data-v-4f9813fa><a class="VPLink link pager-link next" href="/Rasters.jl/previews/PR800/get_started" data-v-4f9813fa><!--[--><span class="desc" data-v-4f9813fa>Next page</span><span class="title" data-v-4f9813fa>Get Started</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-a9a9e638 data-v-c970a860><div class="container" data-v-c970a860><p class="message" data-v-c970a860>Made with <a href="https://luxdl.github.io/DocumenterVitepress.jl/" target="_blank"><strong>DocumenterVitepress.jl</strong></a> <br></p><p class="copyright" data-v-c970a860>© Copyright 2024. Released under the MIT License.</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api.md\":\"D8kTehM_\",\"array_operations.md\":\"B1UT5eHS\",\"data_sources.md\":\"DZ-CJXDF\",\"gbif_wflow.md\":\"B_fcTItY\",\"get_started.md\":\"pNgbhvLg\",\"index.md\":\"CgxmSlcc\",\"methods.md\":\"CHZCoEx9\",\"plot_makie.md\":\"DyxzGbEM\",\"plotting.md\":\"DKKvmLDM\",\"tutorials_spatial_mean.md\":\"DBbIpaS6\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Rasters.jl\",\"description\":\"Manipulating rasterized spatial data\",\"base\":\"/Rasters.jl/previews/PR800/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"outline\":\"deep\",\"logo\":\"/logo.png\",\"search\":{\"provider\":\"local\",\"options\":{\"detailedView\":true}},\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Get Started\",\"link\":\"/get_started\"},{\"text\":\"Methods\",\"items\":[{\"text\":\"Overview\",\"link\":\"/methods\"},{\"text\":\"Array Operations\",\"link\":\"/array_operations\"}]},{\"text\":\"Tutorials\",\"items\":[{\"text\":\"Computing spatial means\",\"link\":\"/tutorials/spatial_mean\"}]},{\"text\":\"Data Sources\",\"items\":[{\"text\":\"Overview\",\"link\":\"/data_sources\"},{\"text\":\"GBIF\",\"link\":\"/gbif_wflow\"}]},{\"text\":\"Plots\",\"items\":[{\"text\":\"Plots.jl\",\"link\":\"/plotting\"},{\"text\":\"Makie.jl\",\"link\":\"/plot_makie\"}]},{\"text\":\"Ecosystem\",\"items\":[{\"text\":\"DimensionalData.jl\",\"link\":\"https://rafaqz.github.io/DimensionalData.jl/dev/\"},{\"text\":\"NCDatasets.jl\",\"link\":\"https://alexander-barth.github.io/NCDatasets.jl/stable/\"},{\"text\":\"ArchGDAL.jl\",\"link\":\"https://yeesian.com/ArchGDAL.jl/stable/\"},{\"text\":\"HDF5.jl\",\"link\":\"https://juliaio.github.io/HDF5.jl/stable/\"}]},{\"text\":\"API\",\"link\":\"/api\"}],\"sidebar\":[{\"text\":\"Get Started\",\"link\":\"/get_started\"},{\"text\":\"Methods\",\"items\":[{\"text\":\"Overview\",\"link\":\"/methods\"},{\"text\":\"Array Operations\",\"link\":\"/array_operations\"}]},{\"text\":\"Data Sources\",\"items\":[{\"text\":\"Overview\",\"link\":\"/data_sources\"},{\"text\":\"GBIF\",\"link\":\"/gbif_wflow\"}]},{\"text\":\"Plots\",\"items\":[{\"text\":\"Plots.jl\",\"link\":\"/plotting\"},{\"text\":\"Makie.jl\",\"link\":\"/plot_makie\"}]},{\"text\":\"API\",\"link\":\"/api\"}],\"editLink\":{\"pattern\":\"REPLACE_ME_DOCUMENTER_VITEPRESS\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/rafaqz/Rasters.jl\"}],\"footer\":{\"message\":\"Made with <a href=\\\"https://luxdl.github.io/DocumenterVitepress.jl/\\\" target=\\\"_blank\\\"><strong>DocumenterVitepress.jl</strong></a> <br>\",\"copyright\":\"© Copyright 2024. Released under the MIT License.\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>